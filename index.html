<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>Binance Plus Demo</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <h1>Binance Plus — Demo</h1>

  <!-- فرم ثبت‌نام -->
  <h2>ثبت‌نام</h2>
  <form id="signup-form">
    <input type="email" id="signup-email" placeholder="ایمیل" required>
    <input type="password" id="signup-pass" placeholder="رمز" required>
    <button type="submit">ثبت‌نام</button>
  </form>

  <!-- فرم ورود -->
  <h2>ورود</h2>
  <form id="login-form">
    <input type="email" id="login-email" placeholder="ایمیل" required>
    <input type="password" id="login-pass" placeholder="رمز" required>
    <button type="submit">ورود</button>
  </form>

  <p id="user-info"></p>

  <!-- فرم برداشت -->
  <div id="withdraw-box" style="display:none;">
    <h2>درخواست برداشت</h2>
    <form id="withdraw-form">
      <input type="number" id="withdraw-amount" placeholder="مقدار" required>
      <input type="text" id="withdraw-address" placeholder="آدرس مقصد" required>
      <button type="submit">ثبت درخواست</button>
    </form>
  </div>

  <script>
    // تنظیمات Supabase
    const SUPABASE_URL = "👉 اینجا Project URL بذار";
    const SUPABASE_KEY = "👉 اینجا anon key بذار";
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // ثبت‌نام
    document.getElementById('signup-form').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const email = document.getElementById('signup-email').value;
      const pass = document.getElementById('signup-pass').value;
      const { error } = await supabase.auth.signUp({ email, password: pass });
      if (error) alert('خطا: ' + error.message);
      else alert('ثبت‌نام موفق — ایمیل تایید ارسال شد.');
    });

    // ورود
    document.getElementById('login-form').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const email = document.getElementById('login-email').value;
      const pass = document.getElementById('login-pass').value;
      const { data, error } = await supabase.auth.signInWithPassword({ email, password: pass });
      if (error) {
        alert('خطا: ' + error.message);
      } else {
        const user = data.user;
        if (!user.email_confirmed_at) {
          alert('ایمیل شما تایید نشده ❌');
          return;
        }
        document.getElementById('user-info').innerText = 'ورود موفق: ' + user.email;
        document.getElementById('withdraw-box').style.display = 'block';
      }
    });

    // درخواست برداشت
    document.getElementById('withdraw-form').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const amount = document.getElementById('withdraw-amount').value;
      const toAddress = document.getElementById('withdraw-address').value;
      const { data: { user } } = await supabase.auth.getUser();

      if (!user) {
        alert('ابتدا وارد شوید');
        return;
      }

      const { error } = await supabase
        .from('withdraw_requests')
        .insert([{ user_id: user.id, amount, to_address: toAddress }]);

      if (error) alert('خطا: ' + error.message);
      else alert('درخواست برداشت ثبت شد ✅ (وضعیت: در انتظار)');
    });
  </script>
</body>
</html>
