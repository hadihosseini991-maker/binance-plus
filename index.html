<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>Binance Plus Demo</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <h1>Binance Plus â€” Demo</h1>

  <!-- ÙØ±Ù… Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… -->
  <h2>Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</h2>
  <form id="signup-form">
    <input type="email" id="signup-email" placeholder="Ø§ÛŒÙ…ÛŒÙ„" required>
    <input type="password" id="signup-pass" placeholder="Ø±Ù…Ø²" required>
    <button type="submit">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</button>
  </form>

  <!-- ÙØ±Ù… ÙˆØ±ÙˆØ¯ -->
  <h2>ÙˆØ±ÙˆØ¯</h2>
  <form id="login-form">
    <input type="email" id="login-email" placeholder="Ø§ÛŒÙ…ÛŒÙ„" required>
    <input type="password" id="login-pass" placeholder="Ø±Ù…Ø²" required>
    <button type="submit">ÙˆØ±ÙˆØ¯</button>
  </form>

  <p id="user-info"></p>

  <!-- ÙØ±Ù… Ø¨Ø±Ø¯Ø§Ø´Øª -->
  <div id="withdraw-box" style="display:none;">
    <h2>Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ø±Ø¯Ø§Ø´Øª</h2>
    <form id="withdraw-form">
      <input type="number" id="withdraw-amount" placeholder="Ù…Ù‚Ø¯Ø§Ø±" required>
      <input type="text" id="withdraw-address" placeholder="Ø¢Ø¯Ø±Ø³ Ù…Ù‚ØµØ¯" required>
      <button type="submit">Ø«Ø¨Øª Ø¯Ø±Ø®ÙˆØ§Ø³Øª</button>
    </form>
  </div>

  <script>
    // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Supabase
    const SUPABASE_URL = "ðŸ‘‰ Ø§ÛŒÙ†Ø¬Ø§ Project URL Ø¨Ø°Ø§Ø±";
    const SUPABASE_KEY = "ðŸ‘‰ Ø§ÛŒÙ†Ø¬Ø§ anon key Ø¨Ø°Ø§Ø±";
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…
    document.getElementById('signup-form').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const email = document.getElementById('signup-email').value;
      const pass = document.getElementById('signup-pass').value;
      const { error } = await supabase.auth.signUp({ email, password: pass });
      if (error) alert('Ø®Ø·Ø§: ' + error.message);
      else alert('Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ù…ÙˆÙÙ‚ â€” Ø§ÛŒÙ…ÛŒÙ„ ØªØ§ÛŒÛŒØ¯ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯.');
    });

    // ÙˆØ±ÙˆØ¯
    document.getElementById('login-form').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const email = document.getElementById('login-email').value;
      const pass = document.getElementById('login-pass').value;
      const { data, error } = await supabase.auth.signInWithPassword({ email, password: pass });
      if (error) {
        alert('Ø®Ø·Ø§: ' + error.message);
      } else {
        const user = data.user;
        if (!user.email_confirmed_at) {
          alert('Ø§ÛŒÙ…ÛŒÙ„ Ø´Ù…Ø§ ØªØ§ÛŒÛŒØ¯ Ù†Ø´Ø¯Ù‡ âŒ');
          return;
        }
        document.getElementById('user-info').innerText = 'ÙˆØ±ÙˆØ¯ Ù…ÙˆÙÙ‚: ' + user.email;
        document.getElementById('withdraw-box').style.display = 'block';
      }
    });

    // Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ø±Ø¯Ø§Ø´Øª
    document.getElementById('withdraw-form').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const amount = document.getElementById('withdraw-amount').value;
      const toAddress = document.getElementById('withdraw-address').value;
      const { data: { user } } = await supabase.auth.getUser();

      if (!user) {
        alert('Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯');
        return;
      }

      const { error } = await supabase
        .from('withdraw_requests')
        .insert([{ user_id: user.id, amount, to_address: toAddress }]);

      if (error) alert('Ø®Ø·Ø§: ' + error.message);
      else alert('Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ø±Ø¯Ø§Ø´Øª Ø«Ø¨Øª Ø´Ø¯ âœ… (ÙˆØ¶Ø¹ÛŒØª: Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±)');
    });
  </script>
</body>
</html>
