<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Binance Plus — Admin Panel (Demo)</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#050507; --card:#0b0c0e; --gold:#d4af37; --muted:#9b9b9b; --accent:#f5f3ea;
  --green:#4caf50; --red:#f44336;
  --glass: rgba(255,255,255,0.03);
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Poppins,system-ui,Arial;background:var(--bg);color:var(--accent);-webkit-font-smoothing:antialiased}
header{position:fixed;top:0;left:0;right:0;height:72px;display:flex;align-items:center;justify-content:space-between;padding:12px 20px;background:rgba(3,3,3,0.8);backdrop-filter:blur(6px);z-index:90}
.brand{display:flex;align-items:center;gap:12px}
.logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--gold),#ffd57a);display:flex;align-items:center;justify-content:center;box-shadow:0 12px 40px rgba(0,0,0,0.6)}
.logo .b{font-weight:900;color:#111;font-family:monospace;font-size:28px;transform:rotate(45deg)}
.header-actions{display:flex;gap:10px;align-items:center}
.btn{padding:8px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:700;transition:all .15s}
.btn-outline{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--accent)}
.btn-primary{background:linear-gradient(90deg,var(--gold),#ffd57a);color:#0b0b0c}
.select{padding:6px 10px;border-radius:10px;background:linear-gradient(90deg,#222,#333);border:none;color:var(--accent);font-weight:600}

/* layout */
.container{display:flex;gap:16px;padding-top:92px;padding-left:20px;padding-right:20px;align-items:flex-start;min-height:calc(100vh - 92px)}
.sidebar{width:300px;background:var(--card);border-radius:12px;padding:16px;flex-shrink:0;border:1px solid rgba(255,255,255,0.03)}
.sidebar .title{font-weight:800;margin-bottom:12px;text-align:center}
.nav{display:flex;flex-direction:column;gap:8px}
.nav button{padding:10px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.03);color:var(--accent);text-align:left;cursor:pointer}
.nav button.active{background:var(--gold);color:#0b0b0c;border-color:rgba(0,0,0,0.2)}
.small{font-size:13px;color:var(--muted)}

/* referral/professional box */
.card{background:var(--glass);border-radius:12px;padding:12px;border:1px solid rgba(255,255,255,0.03)}
.ref-box{background:linear-gradient(135deg,var(--gold),#ffd57a);border-radius:12px;padding:14px;color:#0b0b0b;text-align:center;font-weight:800;box-shadow:0 10px 30px rgba(212,175,55,0.12)}
.ref-code{background:#0b0b0d;color:var(--gold);padding:8px;border-radius:8px;font-family:monospace;font-weight:800;letter-spacing:1px;display:inline-block;margin:8px 0}

/* main area */
.main{flex:1;display:flex;flex-direction:column;gap:14px;min-width:0}
.row{display:flex;gap:14px}
.panel{background:var(--card);border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,0.03);overflow:auto}
.panel.h{height:140px}
.two-col{display:grid;grid-template-columns:1fr 420px;gap:14px}
.table{width:100%;border-collapse:collapse}
.table th,.table td{padding:8px;border-bottom:1px solid rgba(255,255,255,0.04);text-align:left;font-size:13px}
.table th{color:var(--gold);font-weight:700}
.action-btn{padding:6px 8px;border-radius:8px;border:0;cursor:pointer;font-weight:700}

/* marquee editor */
.marquee{background:linear-gradient(90deg, rgba(255,255,255,0.02), transparent);padding:10px;border-radius:8px;overflow:hidden;white-space:nowrap}
.marquee-inner{display:inline-block;animation:marq 30s linear infinite}
@keyframes marq{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}

/* responsive */
@media (max-width:1100px){
  .two-col{grid-template-columns:1fr}
  .sidebar{width:100%}
  .container{flex-direction:column;padding:100px 12px 40px}
}
</style>
</head>
<body>

<header>
  <div class="brand">
    <div class="logo"><div class="b">B</div></div>
    <div>
      <div style="font-weight:800">Binance <span style="color:var(--gold)">Plus</span> — Admin</div>
      <div class="small" id="adminStatus">Admin: OFF</div>
    </div>
  </div>

  <div class="header-actions">
    <select id="langSelect" class="select">
      <option value="en">English</option>
      <option value="fa">فارسی</option>
    </select>
    <button id="adminLoginBtn" class="btn btn-outline">Admin Login</button>
    <button id="saveBtn" class="btn btn-primary" title="Save state to localStorage">Save</button>
  </div>
</header>

<div class="container">

  <!-- LEFT SIDEBAR -->
  <aside class="sidebar">
    <div class="title" id="adminTitle">Admin Panel</div>

    <div style="margin-bottom:10px">
      <div class="small">Search users</div>
      <input id="userSearch" placeholder="name or email" style="width:100%;padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);border:none;color:var(--accent)" />
    </div>

    <div class="nav">
      <button data-view="dashboard" class="active">Dashboard</button>
      <button data-view="users">Users</button>
      <button data-view="deposits">Deposits</button>
      <button data-view="withdrawals">Withdrawals</button>
      <button data-view="tickets">Support Tickets</button>
      <button data-view="wallets">Wallet Addresses</button>
      <button data-view="marquee">Marquee (Ticker)</button>
      <button data-view="settings">Settings (i18n)</button>
    </div>

    <div style="margin-top:12px" class="card">
      <div style="display:flex;gap:8px;align-items:center;justify-content:space-between">
        <div>
          <div class="small">Referrals</div>
          <div style="font-weight:800" id="totalReferrals">12</div>
        </div>
        <div>
          <div class="small">Users</div>
          <div style="font-weight:800" id="totalUsers">0</div>
        </div>
      </div>
    </div>

    <div style="margin-top:12px" class="card">
      <div class="small">Referral Link</div>
      <div class="ref-box">
        <div style="font-size:13px">Your Referral</div>
        <div class="ref-code" id="adminRef">BP-ADMIN-0001</div>
        <button class="btn" id="copyAdminRef" style="background:#0b0b0d;color:var(--gold);width:100%">Copy Link</button>
      </div>
    </div>

  </aside>

  <!-- MAIN -->
  <main class="main">
    <!-- DASHBOARD / VIEWS -->
    <div id="views">

      <!-- Dashboard view -->
      <div data-id="dashboard" class="panel" style="display:block">
        <div class="two-col">
          <div>
            <h3>Overview</h3>
            <div style="display:flex;gap:12px;margin-top:8px">
              <div class="panel h" style="flex:1">
                <div class="small">Total Users</div>
                <div style="font-weight:800;font-size:18px" id="overviewUsers">0</div>
              </div>
              <div class="panel h" style="flex:1">
                <div class="small">Pending Deposits</div>
                <div style="font-weight:800;font-size:18px" id="overviewDeposits">0</div>
              </div>
              <div class="panel h" style="flex:1">
                <div class="small">Pending Withdrawals</div>
                <div style="font-weight:800;font-size:18px" id="overviewWithdrawals">0</div>
              </div>
            </div>

            <div style="margin-top:14px" class="panel">
              <h4>User Activity Marquee</h4>
              <div class="marquee" id="marqueePreview"><div class="marquee-inner" id="marqueeInner">No items yet</div></div>
            </div>

          </div>

          <div>
            <h3>Quick Actions</h3>
            <div style="display:flex;flex-direction:column;gap:10px;margin-top:8px">
              <button class="btn btn-primary" id="addMockUser">Add Mock User</button>
              <button class="btn btn-outline" id="clearAll">Clear All (state)</button>
              <button class="btn btn-outline" id="exportData">Export state (JSON)</button>
            </div>
            <div style="margin-top:12px" class="panel">
              <h4>Wallet Balances (preview)</h4>
              <div id="balancesPreview" class="small">USD: $0</div>
            </div>
          </div>
        </div>
      </div>

      <!-- USERS view -->
      <div data-id="users" class="panel" style="display:none">
        <h3>Users</h3>
        <div style="margin-top:8px" class="small">List of registered users. Click on a row to view details, block or delete.</div>
        <table class="table" id="usersTable" style="margin-top:12px">
          <thead><tr><th>Name</th><th>Email</th><th>Phone</th><th>Balance</th><th>Status</th><th>Actions</th></tr></thead>
          <tbody></tbody>
        </table>

        <div id="userDetail" style="margin-top:12px;display:none"></div>
      </div>

      <!-- DEPOSITS view -->
      <div data-id="deposits" class="panel" style="display:none">
        <h3>Deposits (Pending)</h3>
        <div class="small">Approve deposits to credit user wallets.</div>
        <table class="table" id="depositsTable" style="margin-top:12px">
          <thead><tr><th>User</th><th>Currency</th><th>Network</th><th>Receipt</th><th>Date</th><th>Actions</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- WITHDRAWALS view -->
      <div data-id="withdrawals" class="panel" style="display:none">
        <h3>Withdrawals (Pending)</h3>
        <div class="small">Approve withdrawals to release funds to user's destination address.</div>
        <table class="table" id="withdrawalsTable" style="margin-top:12px">
          <thead><tr><th>User</th><th>Currency</th><th>Address</th><th>Amount</th><th>Date</th><th>Actions</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- TICKETS view -->
      <div data-id="tickets" class="panel" style="display:none">
        <h3>Support Tickets</h3>
        <div class="small">Reply to user tickets here.</div>
        <table class="table" id="ticketsTable" style="margin-top:12px">
          <thead><tr><th>User</th><th>Subject</th><th>Message</th><th>Status</th><th>Actions</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- WALLETS config view -->
      <div data-id="wallets" class="panel" style="display:none">
        <h3>Wallet Addresses (for Deposit)</h3>
        <div class="small">Set the deposit address that users will see when they choose a currency to deposit.</div>

        <div style="display:flex;gap:8px;margin-top:12px;flex-wrap:wrap">
          <input id="walletCurrency" placeholder="Currency (ex: USDT, BTC)" style="padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);border:none;color:var(--accent)" />
          <input id="walletAddress" placeholder="Address" style="padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);border:none;color:var(--accent);width:420px" />
          <button class="btn btn-primary" id="saveWalletAddr">Save</button>
        </div>

        <div style="margin-top:12px">
          <table class="table" id="walletsTable">
            <thead><tr><th>Currency</th><th>Address</th><th>Actions</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- MARQUEE view -->
      <div data-id="marquee" class="panel" style="display:none">
        <h3>Marquee / Ticker Items</h3>
        <div class="small">Add/edit names that appear on the scrolling marquee on the home page or dashboard.</div>

        <div style="display:flex;gap:8px;margin-top:12px">
          <input id="marqueeText" placeholder="Text to show (e.g. User1 +$500)" style="padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);border:none;color:var(--accent);flex:1" />
          <button class="btn btn-primary" id="addMarquee">Add</button>
        </div>

        <div style="margin-top:12px">
          <table class="table" id="marqueeTable">
            <thead><tr><th>Text</th><th>Actions</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- SETTINGS view -->
      <div data-id="settings" class="panel" style="display:none">
        <h3>Settings & Translations</h3>
        <div class="small">Edit English & Persian labels used in admin panel demo (localization preview).</div>

        <div style="display:flex;gap:8px;margin-top:12px">
          <select id="settingsLang" class="select">
            <option value="en">English</option>
            <option value="fa">فارسی</option>
          </select>
          <input id="settingsKey" placeholder="Key (e.g. nav_wallet)" style="padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);border:none;color:var(--accent);flex:1" />
          <input id="settingsVal" placeholder="Value (translation)" style="padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);border:none;color:var(--accent);flex:2" />
          <button class="btn btn-primary" id="saveTranslation">Save</button>
        </div>

        <div style="margin-top:12px">
          <div class="small">Current translations (preview):</div>
          <pre id="translationsPreview" style="white-space:pre-wrap;margin-top:8px;color:var(--muted);"></pre>
        </div>
      </div>

    </div>

  </main>
</div>

<script>
/* ---------------------------
   Admin Demo State (localStorage)
   --------------------------- */
const STORAGE_KEY = 'bp_admin_demo_v1';

const defaultState = {
  adminOn: false,
  wallets: { 'USDT':'TXYZ-DEMO-USDT', 'BTC':'1DEMOBTCADDRESS' },
  users: [
    // sample user
    { id:'u_1', name:'John Doe', email:'john@example.com', phone:'+1 555 111', country:'USA', balance:500, blocked:false, registeredAt:new Date().toLocaleString() }
  ],
  deposits: [
    // example: pending deposit
    // { id:'d_1', userId:'u_1', currency:'USDT', network:'TRC20', receipt:'receipt1.png', amount:100, status:'pending', createdAt: new Date().toLocaleString() }
  ],
  withdrawals: [
    // { id:'w_1', userId:'u_1', currency:'BTC', address:'1ABC...', amount:0.01, status:'pending', createdAt:new Date().toLocaleString() }
  ],
  tickets: [
    // { id:'t_1', userId:'u_1', subject:'Deposit not credited', message:'I sent a deposit', status:'pending', reply:null, createdAt: new Date().toLocaleString() }
  ],
  marquee: ['User1 +$588','User2 +$878'],
  translations: {
    en: {
      nav_wallet: 'Wallet', nav_history:'History', nav_market:'Market', nav_support:'Support'
    },
    fa: {
      nav_wallet: 'کیف پول', nav_history:'تاریخچه', nav_market:'بازار', nav_support:'پشتیبانی'
    }
  }
};

let state = loadState();

/* ---------------------------
   Utility helpers
   --------------------------- */
function saveState(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  // visual feedback
  document.getElementById('saveBtn').innerText = 'Saved';
  setTimeout(()=> document.getElementById('saveBtn').innerText = 'Save', 900);
}

function loadState(){
  try{
    const s = localStorage.getItem(STORAGE_KEY);
    if(!s) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(defaultState));
      return JSON.parse(JSON.stringify(defaultState));
    }
    return JSON.parse(s);
  }catch(e){
    console.error(e);
    return JSON.parse(JSON.stringify(defaultState));
  }
}

function uid(prefix='id'){ return prefix + '_' + Math.random().toString(36).slice(2,9); }

function findUser(id){ return state.users.find(u=>u.id===id); }

/* ---------------------------
   Render / UI
   --------------------------- */
const viewsBtns = document.querySelectorAll('.nav button');
viewsBtns.forEach(b=> b.addEventListener('click', ()=> {
  viewsBtns.forEach(x=> x.classList.remove('active'));
  b.classList.add('active');
  const v = b.dataset.view;
  showView(v);
}));

function showView(name){
  document.querySelectorAll('[data-id]').forEach(el=> el.style.display = (el.dataset.id === name) ? 'block' : 'none');
  // update title or other UI if needed
  refreshAll();
}

/* refresh overview counts, tables etc */
function refreshAll(){
  document.getElementById('overviewUsers').innerText = state.users.length;
  document.getElementById('overviewDeposits').innerText = state.deposits.filter(d=>d.status==='pending').length;
  document.getElementById('overviewWithdrawals').innerText = state.withdrawals.filter(w=>w.status==='pending').length;
  document.getElementById('totalUsers').innerText = state.users.length;
  document.getElementById('totalReferrals').innerText = (state.users.length * 0.6 | 0); // demo value
  document.getElementById('balancesPreview').innerText = 'USD: $' + (state.users.reduce((s,u)=>s+ (u.balance||0),0)).toFixed(2);

  renderUsersTable();
  renderDepositsTable();
  renderWithdrawalsTable();
  renderTicketsTable();
  renderWalletsTable();
  renderMarqueeTable();
  renderMarqueePreview();
  renderTranslationsPreview();
}

/* USERS */
function renderUsersTable(){
  const tbody = document.querySelector('#usersTable tbody');
  tbody.innerHTML = '';
  const search = (document.getElementById('userSearch').value||'').toLowerCase();
  state.users.forEach(u=>{
    if(search && !(u.name||'').toLowerCase().includes(search) && !(u.email||'').toLowerCase().includes(search)) return;
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${u.name}</td><td>${u.email}</td><td>${u.phone||'-'}</td><td>$${(u.balance||0).toFixed(2)}</td><td>${u.blocked ? '<span style="color:var(--red)">Blocked</span>' : 'Active'}</td>
      <td>
        <button class="action-btn" onclick="viewUser('${u.id}')">View</button>
        <button class="action-btn" onclick="toggleBlockUser('${u.id}')">${u.blocked?'Unblock':'Block'}</button>
        <button class="action-btn" onclick="deleteUser('${u.id}')">Delete</button>
      </td>`;
    tbody.appendChild(tr);
  });
}

function viewUser(id){
  const u = findUser(id);
  if(!u) return alert('User not found');
  const detail = document.getElementById('userDetail');
  detail.style.display = 'block';
  detail.innerHTML = `<div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <div style="font-weight:800">${u.name}</div>
        <div class="small">${u.email} · ${u.phone||'-'}</div>
        <div class="small">Country: ${u.country||'-'}</div>
        <div class="small">Registered: ${u.registeredAt||'-'}</div>
      </div>
      <div style="text-align:right">
        <div style="font-weight:800;font-size:20px">$${(u.balance||0).toFixed(2)}</div>
        <div class="small">Invested: $${(u.invested||0).toFixed(2)}</div>
      </div>
    </div>
    <div style="margin-top:10px;display:flex;gap:8px">
      <button class="btn btn-primary" onclick="creditUser('${u.id}')">Credit +</button>
      <button class="btn btn-outline" onclick="debitUser('${u.id}')">Debit -</button>
      <button class="btn" onclick="closeUserDetail()">Close</button>
    </div>
  </div>`;
}

function closeUserDetail(){ document.getElementById('userDetail').style.display='none'; }

function toggleBlockUser(id){
  const u = findUser(id);
  if(!u) return;
  u.blocked = !u.blocked;
  saveState();
  refreshAll();
}

function deleteUser(id){
  if(!confirm('Delete user permanently?')) return;
  state.users = state.users.filter(u=>u.id!==id);
  // also remove related deposits/withdrawals/tickets
  state.deposits = state.deposits.filter(d=>d.userId!==id);
  state.withdrawals = state.withdrawals.filter(w=>w.userId!==id);
  state.tickets = state.tickets.filter(t=>t.userId!==id);
  saveState(); refreshAll();
}

/* quick credit/debit (simple promt) */
function creditUser(id){
  const u = findUser(id);
  const amt = parseFloat(prompt('Amount to credit (USD):', '100'));
  if(isNaN(amt) || amt<=0) return alert('Invalid amount');
  u.balance = (u.balance||0) + amt;
  saveState(); refreshAll(); alert('Credited $' + amt);
}
function debitUser(id){
  const u = findUser(id);
  const amt = parseFloat(prompt('Amount to debit (USD):', '50'));
  if(isNaN(amt) || amt<=0) return alert('Invalid amount');
  u.balance = Math.max(0, (u.balance||0) - amt);
  saveState(); refreshAll(); alert('Debited $' + amt);
}

/* DEPOSITS */
function renderDepositsTable(){
  const tbody = document.querySelector('#depositsTable tbody');
  tbody.innerHTML = '';
  state.deposits.forEach(d=>{
    const u = findUser(d.userId) || {name:'Unknown'};
    if(d.status !== 'pending') return;
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${u.name}</td><td>${d.currency}</td><td>${d.network}</td><td>${d.receipt||'-'}</td><td>${d.createdAt}</td>
      <td>
        <button class="action-btn" onclick="approveDeposit('${d.id}')">Approve</button>
        <button class="action-btn" onclick="rejectDeposit('${d.id}')">Reject</button>
      </td>`;
    tbody.appendChild(tr);
  });
}

function approveDeposit(id){
  const d = state.deposits.find(x=>x.id===id);
  if(!d) return;
  const u = findUser(d.userId);
  // credit amount to user (if amount available)
  const amount = d.amount || 100; // demo: if amount missing, credit 100
  if(u){ u.balance = (u.balance||0) + amount; }
  d.status = 'completed';
  saveState(); refreshAll(); alert('Deposit approved and wallet credited $' + amount);
}
function rejectDeposit(id){
  if(!confirm('Reject deposit?')) return;
  const d = state.deposits.find(x=>x.id===id); if(!d) return;
  d.status = 'rejected';
  saveState(); refreshAll();
}

/* WITHDRAWALS */
function renderWithdrawalsTable(){
  const tbody = document.querySelector('#withdrawalsTable tbody');
  tbody.innerHTML = '';
  state.withdrawals.forEach(w=>{
    if(w.status !== 'pending') return;
    const u = findUser(w.userId) || {name:'Unknown'};
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${u.name}</td><td>${w.currency}</td><td>${w.address}</td><td>${w.amount}</td><td>${w.createdAt}</td>
      <td>
        <button class="action-btn" onclick="approveWithdraw('${w.id}')">Approve</button>
        <button class="action-btn" onclick="rejectWithdraw('${w.id}')">Reject</button>
      </td>`;
    tbody.appendChild(tr);
  });
}

function approveWithdraw(id){
  const w = state.withdrawals.find(x=>x.id===id); if(!w) return;
  const u = findUser(w.userId);
  if(u){
    if((u.balance||0) < w.amount){ return alert('User has insufficient balance'); }
    u.balance -= w.amount;
  }
  w.status = 'completed';
  saveState(); refreshAll(); alert('Withdrawal approved and processed (demo).');
}
function rejectWithdraw(id){
  if(!confirm('Reject withdrawal?')) return;
  const w = state.withdrawals.find(x=>x.id===id); if(!w) return;
  w.status = 'rejected';
  saveState(); refreshAll();
}

/* TICKETS */
function renderTicketsTable(){
  const tbody = document.querySelector('#ticketsTable tbody');
  tbody.innerHTML = '';
  state.tickets.forEach(t=>{
    const u = findUser(t.userId) || {name:'Unknown'};
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${u.name}</td><td>${t.subject}</td><td>${t.message}</td><td>${t.status}</td>
      <td>
        <button class="action-btn" onclick="replyTicket('${t.id}')">Reply</button>
        <button class="action-btn" onclick="closeTicket('${t.id}')">Close</button>
      </td>`;
    tbody.appendChild(tr);
  });
}

function replyTicket(id){
  const t = state.tickets.find(x=>x.id===id); if(!t) return;
  const reply = prompt('Write reply to user:', t.reply || '');
  if(reply === null) return;
  t.reply = reply; t.status = 'answered';
  saveState(); refreshAll(); alert('Reply saved (demo).');
}
function closeTicket(id){
  if(!confirm('Close ticket?')) return;
  const t = state.tickets.find(x=>x.id===id); if(!t) return;
  t.status = 'closed';
  saveState(); refreshAll();
}

/* WALLETS CONFIG */
function renderWalletsTable(){
  const tbody = document.querySelector('#walletsTable tbody');
  tbody.innerHTML = '';
  Object.keys(state.wallets || {}).forEach(currency=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${currency}</td><td>${state.wallets[currency]}</td><td>
      <button class="action-btn" onclick="editWallet('${currency}')">Edit</button>
      <button class="action-btn" onclick="deleteWallet('${currency}')">Delete</button>
    </td>`;
    tbody.appendChild(tr);
  });
}

document.getElementById('saveWalletAddr').addEventListener('click', ()=>{
  const cur = (document.getElementById('walletCurrency').value||'').trim().toUpperCase();
  const addr = (document.getElementById('walletAddress').value||'').trim();
  if(!cur || !addr) return alert('Enter currency and address');
  state.wallets[cur] = addr;
  saveState(); renderWalletsTable(); alert('Saved wallet address for ' + cur);
  document.getElementById('walletCurrency').value=''; document.getElementById('walletAddress').value='';
});
function editWallet(currency){
  const addr = state.wallets[currency];
  const newAddr = prompt('Edit address for ' + currency, addr);
  if(newAddr === null) return;
  state.wallets[currency] = newAddr.trim();
  saveState(); renderWalletsTable();
}
function deleteWallet(currency){
  if(!confirm('Delete wallet entry for ' + currency + '?')) return;
  delete state.wallets[currency];
  saveState(); renderWalletsTable();
}

/* MARQUEE management */
function renderMarqueeTable(){
  const tbody = document.querySelector('#marqueeTable tbody');
  tbody.innerHTML='';
  state.marquee.forEach((txt, idx)=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${txt}</td><td>
      <button class="action-btn" onclick="editMarquee(${idx})">Edit</button>
      <button class="action-btn" onclick="deleteMarquee(${idx})">Delete</button>
    </td>`;
    tbody.appendChild(tr);
  });
}
function renderMarqueePreview(){
  const el = document.getElementById('marqueeInner');
  if(state.marquee.length===0){ el.innerText = 'No items yet'; return; }
  el.innerText = state.marquee.join('  •  ') + '  •  ' + state.marquee.join('  •  ');
}
document.getElementById('addMarquee').addEventListener('click', ()=>{
  const txt = (document.getElementById('marqueeText').value||'').trim();
  if(!txt) return;
  state.marquee.push(txt);
  document.getElementById('marqueeText').value='';
  saveState(); renderMarqueeTable(); renderMarqueePreview();
});
function editMarquee(i){
  const newTxt = prompt('Edit text', state.marquee[i]);
  if(newTxt === null) return;
  state.marquee[i] = newTxt.trim();
  saveState(); renderMarqueeTable(); renderMarqueePreview();
}
function deleteMarquee(i){
  if(!confirm('Delete item?')) return;
  state.marquee.splice(i,1);
  saveState(); renderMarqueeTable(); renderMarqueePreview();
}

/* TRANSLATIONS editing (simple) */
function renderTranslationsPreview(){
  document.getElementById('translationsPreview').innerText = JSON.stringify(state.translations, null, 2);
}
document.getElementById('saveTranslation').addEventListener('click', ()=>{
  const lang = document.getElementById('settingsLang').value;
  const key = document.getElementById('settingsKey').value.trim();
  const val = document.getElementById('settingsVal').value.trim();
  if(!key || !val) return alert('Enter key and value');
  state.translations[lang] = state.translations[lang] || {};
  state.translations[lang][key] = val;
  document.getElementById('settingsKey').value=''; document.getElementById('settingsVal').value='';
  saveState(); renderTranslationsPreview(); alert('Saved translation for ' + lang);
});

/* ---------------------------
   Admin login toggle & helpers
   --------------------------- */
document.getElementById('adminLoginBtn').addEventListener('click', ()=>{
  state.adminOn = !state.adminOn;
  document.getElementById('adminStatus').innerText = 'Admin: ' + (state.adminOn ? 'ON' : 'OFF');
  document.getElementById('adminLoginBtn').innerText = state.adminOn ? 'Logout Admin' : 'Admin Login';
  saveState(); refreshAll();
});

/* ---------------------------
   Mock / utility actions
   --------------------------- */
document.getElementById('addMockUser').addEventListener('click', ()=>{
  const id = uid('u');
  state.users.push({ id, name:'User '+ (state.users.length+1), email: 'user'+(state.users.length+1)+'@mail.com', phone:'+000', country:'-', balance: Math.round(Math.random()*1000), invested:0, blocked:false, registeredAt:new Date().toLocaleString() });
  saveState(); refreshAll();
});

document.getElementById('clearAll').addEventListener('click', ()=>{
  if(!confirm('Reset demo state to defaults?')) return;
  state = JSON.parse(JSON.stringify(defaultState));
  saveState(); refreshAll(); alert('State reset');
});

document.getElementById('exportData').addEventListener('click', ()=>{
  const data = JSON.stringify(state,null,2);
  const blob = new Blob([data],{type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download='bp_admin_state.json'; a.click();
  URL.revokeObjectURL(url);
});

/* user search */
document.getElementById('userSearch').addEventListener('input', ()=>{
  renderUsersTable();
});

/* copy admin ref */
document.getElementById('copyAdminRef').addEventListener('click', ()=>{
  navigator.clipboard.writeText('https://binanceplus.com/ref/' + document.getElementById('adminRef').innerText);
  alert('Referral link copied');
});

/* export/import / save button */
document.getElementById('saveBtn').addEventListener('click', saveState);

/* language switcher for admin UI (very simple) */
document.getElementById('langSelect').addEventListener('change', (e)=>{
  const lang = e.target.value;
  applyAdminLang(lang);
});

/* apply translations for admin UI labels (simple keys) */
function applyAdminLang(lang){
  const t = state.translations[lang] || {};
  // map some keys
  document.querySelectorAll('[data-translate]').forEach(el=>{
    const key = el.getAttribute('data-translate');
    if(t[key]) el.innerHTML = t[key];
  });
  // nav buttons
  document.querySelectorAll('.nav button').forEach(btn=>{
    const key = btn.dataset.view === 'wallets' ? 'nav_wallets' : 'nav_' + (btn.dataset.view||'');
    if(t[key]) btn.innerText = t[key];
  });
  // small other UI texts (basic)
  document.getElementById('adminTitle').innerText = (lang==='fa' ? 'پنل مدیریت' : 'Admin Panel');
}

/* ---------------------------
   Simulate users making deposit/withdraw requests
   (for demo: you can add entries manually)
   --------------------------- */
// helper to add a deposit (simulate user action)
function simulateUserDeposit(userId,currency,network,amount,receipt){
  state.deposits.unshift({ id: uid('d'), userId, currency, network, amount, receipt: receipt||'', status:'pending', createdAt: new Date().toLocaleString()});
  saveState(); refreshAll();
}
// helper to add withdraw
function simulateUserWithdraw(userId,currency,address,amount){
  state.withdrawals.unshift({ id: uid('w'), userId, currency, address, amount, status:'pending', createdAt: new Date().toLocaleString()});
  saveState(); refreshAll();
}

// for demo, add a couple items if none exist
if(state.users.length === 0){
  state.users.push({ id:'u_demo', name:'Demo User', email:'demo@demo.com', phone:'+0', country:'-', balance:200, invested:0, blocked:false, registeredAt:new Date().toLocaleString() });
  saveState();
}
if(state.marquee.length === 0) { state.marquee.push('Welcome to Binance Plus Admin'); saveState(); }

refreshAll();

/* expose some functions to window for buttons in tables */
window.viewUser = viewUser;
window.toggleBlockUser = toggleBlockUser;
window.deleteUser = deleteUser;
window.approveDeposit = approveDeposit;
window.rejectDeposit = rejectDeposit;
window.approveWithdraw = approveWithdraw;
window.rejectWithdraw = rejectWithdraw;
window.replyTicket = replyTicket;
window.closeTicket = closeTicket;
window.editWallet = editWallet;
window.deleteWallet = deleteWallet;
window.editMarquee = editMarquee;
window.deleteMarquee = deleteMarquee;

/* load translations preview initially */
renderTranslationsPreview();

</script>
</body>
</html>
